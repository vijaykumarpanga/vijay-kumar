<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Decentralized Resume Verification</title>

  <!-- âœ… React + Babel + Ethers (Stable sources) -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 0;
    }
    .container {
      width: 90%;
      max-width: 900px;
      margin: 40px auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px 40px;
    }
    h1 { text-align: center; color: #333; }
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #2563eb;
      color: white;
      font-weight: bold;
      margin-top: 8px;
    }
    button:hover { background: #1e40af; }
    input {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .resume-item {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 16px;
      margin-top: 12px;
      background: #f9fafb;
    }
    .resume-badge {
      padding: 6px 10px;
      border-radius: 12px;
      font-size: 12px;
      color: white;
    }
    .verified { background-color: #16a34a; }
    .pending { background-color: #f59e0b; }
    .skill-tag {
      display: inline-block;
      background: #e0f2fe;
      color: #0369a1;
      padding: 4px 8px;
      margin: 4px;
      border-radius: 8px;
      font-size: 13px;
    }
    .tabs button {
      background: #e5e7eb;
      color: #111827;
      margin: 5px;
    }
    .tabs .active { background: #2563eb; color: white; }
    .btn-primary { background: #2563eb; color: white; }
    .btn-success { background: #16a34a; color: white; }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">

    const CONTRACT_ADDRESS = "0x782A76396205A4cf42A1a14c2221a42229eAC21d"; // ðŸ”¹ Replace with your actual deployed contract address
    const CONTRACT_ABI =[
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "ResumeSubmitted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "verifier",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "ResumeVerified",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_education",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "_skills",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "_ipfsHash",
				"type": "string"
			}
		],
		"name": "submitResume",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_newAdmin",
				"type": "address"
			}
		],
		"name": "transferAdmin",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "unverifyResume",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "verifyResume",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getAllResumes",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "getResume",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "education",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "skills",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "ipfsHash",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "isVerified",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "getResumeOwner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getUnverifiedResumes",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_user",
				"type": "address"
			}
		],
		"name": "getUserResumes",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getVerifiedResumes",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "isResumeVerified",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "resumeCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "resumes",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "education",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "ipfsHash",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "isVerified",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "userResumes",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

    function App() {
      const [account, setAccount] = React.useState(null);
      const [contract, setContract] = React.useState(null);
      const [resumes, setResumes] = React.useState([]);
      const [formData, setFormData] = React.useState({
        name: "", email: "", education: "", skills: "", ipfsHash: ""
      });

      // âœ… Connect MetaMask
      async function connectWallet() {
        try {
          if (!window.ethereum) {
            alert("Please install MetaMask!");
            return;
          }
          const provider = new ethers.providers.Web3Provider(window.ethereum);
          await provider.send("eth_requestAccounts", []);
          const signer = provider.getSigner();
          const address = await signer.getAddress();
          setAccount(address);

          const contractInstance = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
          setContract(contractInstance);

          console.log("Wallet Connected:", address);
          alert("Wallet connected: " + address);
          loadResumes(contractInstance);
        } catch (err) {
          alert("Connection failed: " + err.message);
        }
      }

      // âœ… Load resumes from blockchain
      async function loadResumes(contractInstance) {
        try {
          const resumeIds = await contractInstance.getAllResumes();
          const allResumes = [];
          for (let id of resumeIds) {
            const r = await contractInstance.getResume(id);
            allResumes.push({ id: id.toString(), ...r });
          }
          setResumes(allResumes);
        } catch (err) {
          console.error("Error loading resumes:", err);
        }
      }

      // âœ… Submit new resume
      async function submitResume() {
        try {
          if (!contract) return alert("Connect wallet first!");
          const { name, email, education, skills, ipfsHash } = formData;
          const tx = await contract.submitResume(
            name, email, education, skills.split(",").map(s => s.trim()), ipfsHash
          );
          await tx.wait();
          alert("Resume submitted successfully!");
          loadResumes(contract);
        } catch (err) {
          alert("Error submitting resume: " + err.message);
        }
      }

      // âœ… Verify / Unverify
      async function verifyResume(id) {
        const tx = await contract.verifyResume(id);
        await tx.wait();
        loadResumes(contract);
      }

      async function unverifyResume(id) {
        const tx = await contract.unverifyResume(id);
        await tx.wait();
        loadResumes(contract);
      }

      return (
        <div className="container">
          <h1>Decentralized Resume Verification</h1>

          {!account ? (
            <button onClick={connectWallet}>Connect Wallet</button>
          ) : (
            <p><strong>Connected:</strong> {account}</p>
          )}

          <h2>Submit Resume</h2>
          <input type="text" placeholder="Full Name" onChange={e => setFormData({...formData, name: e.target.value})}/>
          <input type="email" placeholder="Email" onChange={e => setFormData({...formData, email: e.target.value})}/>
          <input type="text" placeholder="Education" onChange={e => setFormData({...formData, education: e.target.value})}/>
          <input type="text" placeholder="Skills (comma separated)" onChange={e => setFormData({...formData, skills: e.target.value})}/>
          <input type="text" placeholder="IPFS Hash" onChange={e => setFormData({...formData, ipfsHash: e.target.value})}/>
          <button onClick={submitResume}>Submit Resume</button>

          <hr/>
          <h2>Resume Records</h2>
          {resumes.length === 0 && <p>No resumes found.</p>}
          {resumes.map((resume, i) => (
            <div key={i} className="resume-item">
              <div style={{display:'flex',justifyContent:'space-between'}}>
                <div>
                  <h3>{resume.name}</h3>
                  <p>{resume.email}</p>
                </div>
                <span className={`resume-badge ${resume.isVerified ? 'verified' : 'pending'}`}>
                  {resume.isVerified ? 'Verified' : 'Pending'}
                </span>
              </div>
              <p><strong>Education:</strong> {resume.education}</p>
              <div>
                {resume.skills.map((s, idx) => <span key={idx} className="skill-tag">{s}</span>)}
              </div>
              <div style={{marginTop:'10px'}}>
                {resume.ipfsHash && (
                  <a href={`https://ipfs.io/ipfs/${resume.ipfsHash}`} target="_blank" rel="noopener noreferrer">
                    <button className="btn-primary">View on IPFS</button>
                  </a>
                )}
                {resume.isVerified ? (
                  <button className="btn-primary" onClick={() => unverifyResume(resume.id)}>Unverify</button>
                ) : (
                  <button className="btn-success" onClick={() => verifyResume(resume.id)}>Verify</button>
                )}
              </div>
            </div>
          ))}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
