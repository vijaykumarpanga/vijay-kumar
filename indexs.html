<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Decentralized Resume Verification</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f6f8fa;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      background-color: #0d1117;
      color: white;
      padding: 15px 0;
      font-size: 22px;
    }
    .container {
      width: 90%;
      max-width: 600px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover { background-color: #0056b3; }
    input, textarea {
      width: 95%;
      padding: 8px;
      margin: 5px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .status { margin-top: 10px; font-weight: bold; }
    .status.connected { color: green; }
    .status.error { color: red; }
    .status.verified { color: blue; }
    .resume-card {
      background: #f0f0f0;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      text-align: left;
    }
  </style>
</head>
<body>
  <header>
    Decentralized Resume Verification System
  </header>

  <div class="container">
    <h3>üîó Connect Wallet</h3>
    <button id="connectWalletBtn">Connect Wallet</button>
    <p id="walletStatus" class="status">Not Connected</p>
    <hr>

    <h3>üìù Submit Resume</h3>
    <input type="text" id="name" placeholder="Name"><br>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="text" id="qualification" placeholder="Qualification"><br>
    <input type="text" id="skills" placeholder="Skills (comma separated)"><br>
    <textarea id="experience" placeholder="Experience"></textarea><br>
    <button id="submitResumeBtn">Submit Resume</button>
    <p id="submissionStatus" class="status"></p>
    <hr>

    <h3>üìÑ View My Resumes</h3>
    <button id="viewMyResumesBtn">View Resumes</button>
    <div id="resumeList"></div>
    <hr>

    <h3>‚úÖ Admin Panel</h3>
    <button id="verifyBtn">Verify Resume</button>
    <p id="verificationStatus" class="status"></p>
  </div>

  <script>
    const CONTRACT_ADDRESS = "0xd9145CCE52D386f254917e481eB44e9943F39138"; // üß† Replace this
    const ABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "resumeId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "ResumeSubmitted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "resumeId",
				"type": "uint256"
			}
		],
		"name": "ResumeVerified",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_qualification",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "_skills",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "_experience",
				"type": "string"
			}
		],
		"name": "submitResume",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "fallback"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "verifyResume",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getMyResumeIds",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "getResume",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "qualification",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "skills",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "experience",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "verified",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "submittedBy",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "resumeCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "resumes",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "qualification",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "experience",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "verified",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "submittedBy",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "resumesByUser",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

    let provider, signer, contract, userAddress, adminAddress;

    async function connectWallet() {
      try {
        if (typeof window.ethereum === "undefined") {
          alert("‚ö†Ô∏è MetaMask not detected! Install it first.");
          window.open("https://metamask.io/download.html");
          return;
        }

        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();

        contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
        adminAddress = await contract.admin();

        const walletStatus = document.getElementById("walletStatus");
        walletStatus.innerText = `‚úÖ Connected: ${userAddress.slice(0,6)}...${userAddress.slice(-4)}`;
        walletStatus.className = "status connected";

        // show verify button only for admin
        const verifyButton = document.getElementById("verifyBtn");
        if (userAddress.toLowerCase() === adminAddress.toLowerCase()) {
          verifyButton.style.display = "block";
        } else {
          verifyButton.style.display = "none";
        }

        console.log("Connected Wallet:", userAddress);
        console.log("Admin Address:", adminAddress);
      } catch (error) {
        console.error("Wallet connection failed:", error);
        document.getElementById("walletStatus").innerText = "‚ùå Connection failed.";
        document.getElementById("walletStatus").className = "status error";
      }
    }

    async function submitResume() {
      try {
        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const qualification = document.getElementById("qualification").value;
        const skills = document.getElementById("skills").value.split(",");
        const experience = document.getElementById("experience").value;
        const status = document.getElementById("submissionStatus");

        if (!contract) {
          alert("‚ö†Ô∏è Please connect your wallet first!");
          return;
        }

        if (!name || !email) {
          alert("Please fill all required fields.");
          return;
        }

        const tx = await contract.submitResume(name, email, qualification, skills, experience);
        await tx.wait();

        status.innerText = "‚úÖ Resume submitted successfully!";
        status.className = "status connected";
      } catch (error) {
        console.error(error);
        document.getElementById("submissionStatus").innerText = "‚ùå Submission failed.";
      }
    }

    async function viewMyResumes() {
      const resumeList = document.getElementById("resumeList");
      resumeList.innerHTML = "";
      try {
        const ids = await contract.getMyResumeIds();
        for (let id of ids) {
          const r = await contract.getResume(id);
          const card = document.createElement("div");
          card.className = "resume-card";
          card.innerHTML = `
            <strong>ID:</strong> ${id}<br>
            <strong>Name:</strong> ${r[0]}<br>
            <strong>Email:</strong> ${r[1]}<br>
            <strong>Qualification:</strong> ${r[2]}<br>
            <strong>Skills:</strong> ${r[3].join(", ")}<br>
            <strong>Experience:</strong> ${r[4]}<br>
            <strong>Verified:</strong> ${r[5] ? "‚úÖ Yes" : "‚ùå No"}<br>
          `;
          resumeList.appendChild(card);
        }
      } catch (error) {
        console.error("Error fetching resumes:", error);
        resumeList.innerText = "‚ùå Unable to fetch resumes.";
      }
    }

    async function verifyResume() {
      try {
        const resumeId = prompt("Enter Resume ID to verify:");
        if (!resumeId) return;

        const tx = await contract.verifyResume(resumeId);
        await tx.wait();

        document.getElementById("verificationStatus").innerText = "‚úÖ Resume Verified Successfully";
        document.getElementById("verificationStatus").className = "status verified";
      } catch (error) {
        console.error(error);
        document.getElementById("verificationStatus").innerText = "‚ùå Error verifying resume";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("connectWalletBtn").addEventListener("click", connectWallet);
      document.getElementById("submitResumeBtn").addEventListener("click", submitResume);
      document.getElementById("viewMyResumesBtn").addEventListener("click", viewMyResumes);
      document.getElementById("verifyBtn").addEventListener("click", verifyResume);
    });
  </script>
</body>
</html>
