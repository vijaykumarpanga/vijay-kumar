<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decentralized Resume Verification</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f6f8fa; text-align: center; }
    header { background-color: #0d1117; color: white; padding: 15px 0; font-size: 22px; }
    .container { width: 90%; max-width: 600px; margin: 20px auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    button { background-color: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 16px; }
    button:hover { background-color: #0056b3; }
    input, textarea { width: 95%; padding: 8px; margin: 5px 0; border-radius: 6px; border: 1px solid #ccc; }
    .status { margin-top: 10px; font-weight: bold; }
    .connected { color: green; }
    .error { color: red; }
    .verified { color: blue; }
    .resume-card { background: #f0f0f0; padding: 10px; margin-top: 10px; border-radius: 8px; text-align: left; }
  </style>
</head>
<body>
  <header>Decentralized Resume Verification System</header>

  <div class="container">
    <h3>üîó Connect Wallet</h3>
    <button id="connectWalletBtn">Connect Wallet</button>
    <p id="walletStatus" class="status">Not Connected</p>

    <hr>
    <h3>üìù Submit Resume</h3>
    <input type="text" id="name" placeholder="Name"><br>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="text" id="qualification" placeholder="Qualification"><br>
    <input type="text" id="skills" placeholder="Skills (comma separated)"><br>
    <textarea id="experience" placeholder="Experience"></textarea><br>
    <button id="submitResumeBtn">Submit Resume</button>
    <p id="submissionStatus" class="status"></p>

    <hr>
    <h3>üìÑ View My Resumes</h3>
    <button id="viewMyResumesBtn">View Resumes</button>
    <div id="resumeList"></div>

    <hr>
    <h3>‚úÖ Admin Panel</h3>
    <button id="verifyBtn" style="display:none;">Verify Resume</button>
    <p id="verificationStatus" class="status"></p>
  </div>

  <script>
    const CONTRACT_ADDRESS = "0xd9145CCE52D386f254917e481eB44e9943F39138"; // Replace with your address
    const ABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "resumeId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			}
		],
		"name": "ResumeSubmitted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "resumeId",
				"type": "uint256"
			}
		],
		"name": "ResumeVerified",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_qualification",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "_skills",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "_experience",
				"type": "string"
			}
		],
		"name": "submitResume",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "fallback"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "verifyResume",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getMyResumeIds",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_resumeId",
				"type": "uint256"
			}
		],
		"name": "getResume",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "qualification",
				"type": "string"
			},
			{
				"internalType": "string[]",
				"name": "skills",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "experience",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "verified",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "submittedBy",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "resumeCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "resumes",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "qualification",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "experience",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "verified",
				"type": "bool"
			},
			{
				"internalType": "address",
				"name": "submittedBy",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "resumesByUser",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

    let provider, signer, contract, userAddress, adminAddress;

    async function connectWallet() {
      const walletStatus = document.getElementById("walletStatus");
      try {
        if (!window.ethereum) {
          alert("‚ö†Ô∏è MetaMask not found. Install it first!");
          window.open("https://metamask.io/download.html");
          return;
        }

        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();

        walletStatus.innerText = `‚úÖ Connected: ${userAddress.slice(0,6)}...${userAddress.slice(-4)}`;
        walletStatus.className = "status connected";

        contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
        adminAddress = await contract.admin();

        // show admin panel if admin
        if (userAddress.toLowerCase() === adminAddress.toLowerCase()) {
          document.getElementById("verifyBtn").style.display = "block";
        }

      } catch (err) {
        console.error("Wallet connection failed:", err);
        walletStatus.innerText = "‚ùå Connection failed. Check console.";
        walletStatus.className = "status error";
      }
    }

    async function submitResume() {
      if (!contract) return alert("Connect wallet first!");

      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const qualification = document.getElementById("qualification").value;
      const skills = document.getElementById("skills").value.split(",");
      const experience = document.getElementById("experience").value;
      const status = document.getElementById("submissionStatus");

      if (!name || !email) return alert("Please fill all fields!");

      try {
        const tx = await contract.submitResume(name, email, qualification, skills, experience);
        await tx.wait();
        status.innerText = "‚úÖ Resume submitted successfully!";
        status.className = "status connected";
      } catch (err) {
        console.error("Submission error:", err);
        status.innerText = "‚ùå Submission failed.";
        status.className = "status error";
      }
    }

    async function viewMyResumes() {
      if (!contract) return alert("Connect wallet first!");
      const resumeList = document.getElementById("resumeList");
      resumeList.innerHTML = "";

      try {
        const ids = await contract.getMyResumeIds();
        for (const id of ids) {
          const r = await contract.getResume(id);
          const card = document.createElement("div");
          card.className = "resume-card";
          card.innerHTML = `
            <strong>ID:</strong> ${id}<br>
            <strong>Name:</strong> ${r[0]}<br>
            <strong>Email:</strong> ${r[1]}<br>
            <strong>Qualification:</strong> ${r[2]}<br>
            <strong>Skills:</strong> ${r[3].join(", ")}<br>
            <strong>Experience:</strong> ${r[4]}<br>
            <strong>Verified:</strong> ${r[5] ? "‚úÖ Yes" : "‚ùå No"}<br>
          `;
          resumeList.appendChild(card);
        }
      } catch (err) {
        console.error("Error fetching resumes:", err);
        resumeList.innerText = "‚ùå Error fetching resumes.";
      }
    }

    async function verifyResume() {
      if (!contract) return alert("Connect wallet first!");
      const id = prompt("Enter Resume ID to verify:");
      if (!id) return;
      const status = document.getElementById("verificationStatus");

      try {
        const tx = await contract.verifyResume(id);
        await tx.wait();
        status.innerText = "‚úÖ Resume verified successfully!";
        status.className = "status verified";
      } catch (err) {
        console.error("Verification failed:", err);
        status.innerText = "‚ùå Verification failed.";
        status.className = "status error";
      }
    }

    // Attach events after DOM loads
    window.onload = function() {
      document.getElementById("connectWalletBtn").onclick = connectWallet;
      document.getElementById("submitResumeBtn").onclick = submitResume;
      document.getElementById("viewMyResumesBtn").onclick = viewMyResumes;
      document.getElementById("verifyBtn").onclick = verifyResume;
    };
  </script>
</body>
</html>
